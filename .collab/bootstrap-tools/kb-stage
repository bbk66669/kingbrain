#!/usr/bin/env bash
# bootstrap 版：只为"提前准备/FAKE链路验收"提供最小壳
set -euo pipefail
BASE="${KB_API_BASE:-http://kb.mwwnd.org/kb-api}"
PHASE="${1:-}"; TASK="${2:-scaffold}"; WAIT="${WAIT:-0}"
[ -z "$PHASE" ] && { echo "usage: kb-stage <ack|plan|borrow|diff|cr> [task]"; exit 1; }
RESP="$(curl -sS -X POST "$BASE/$PHASE" -H 'Content-Type: application/json' -d "{\"task\":\"$TASK\",\"notes\":\"bootstrap\"}")"
echo "$RESP" | jq .
WID="$(echo "$RESP" | jq -r '.workflow_id // empty')"
[ -n "$WID" ] && [ "$WAIT" != "0" ] && curl -sS "$BASE/runs/$WID?wait=$WAIT" | jq .
